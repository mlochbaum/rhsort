# SVG utilities
Enc â‡ {
  DeNest â† {(3âŒŠâ‰¡)â—¶âŸ¨!âˆ˜0,â‹ˆ,âŠ¢,âˆ¾ğ•ŠÂ¨âŸ© â¥Šğ•©}
  open â† âˆ¾âŸ¨"<",ğ•¨,">"âŸ©
  closeâ† âˆ¾âŸ¨"</", (âˆ§`ğ•¨â‰ ' ')/ğ•¨, ">"âŸ©
  l â† 1 < dâ†â‰¡ğ•©
  âˆ¾ open ({"  "âŠ¸âˆ¾Â¨(âˆ¾DeNestÂ¨)âŸ(3â‰¤d)â¥Šğ•©}âŸl ğ•©){ğ•¨â€¿ğ•—â€¿ğ•©}â—‹(â¥Šâˆ˜<âŸl) close
}
At1 â† " " âˆ¾ {âˆ¾âŸ¨ğ•¨,"='",ğ•©,"'"âŸ©}Â´
Attr â‡ âˆ¾âŸœ(âˆ¾ <âˆ˜At1â‰1)
At â‡ {
  _s â† {((+`Ã—Â¬)âŠ¸-ğ•—âŠ¸=)âŠ¸âŠ”}
  ğ•¨ >âŠ˜(âˆ¾âŸœ(âˆ¾At1Â¨)) '='_sÂ¨ '|'_s ğ•©
}
Elt â‡ {âˆ¾âŸ¨"<",ğ•©,"/>"âŸ©}Attr
Num â‡ ('Â¯' (âŠ¢+=Ã—'-'âŠ¸-) (âˆ§`4â¥ŠâŸœ1âŠ¸Â»'.'âŠ¸â‰ )âŠ¸/âˆ˜â€¢Repr)âš‡0
Pos â‡ âŸ¨"x","y"âŸ© â‰Ë˜ Num
SVG â‡ {
  a â† âŸ¨"viewBox",1â†“âˆ¾' 'âˆ¾Â¨Num ğ•¨âŸ©âˆ¾"height"â€¿"width"â‰Ë˜Num 1.5Ã—âŒ½2â†“ğ•¨
  a âˆ¾â†© "xmlns"â€¿"http://www.w3.org/2000/svg"
  ("svg" Attr a) Enc ğ•©
}

Ge â‡ "g"âŠ¸AtâŠ¸Enc
Rdim â‡ Posâˆ˜âŠâˆ¾"width"â€¿"height"â‰Ë˜Â·NumâŠ¢Ë
Rect â‡ "rect" Elt RdimâŠ˜(AtâŠ¸âˆ¾âŸœRdim)
Path â‡ "path" Elt "d"âŠ¸â‹ˆâŠ˜(âŠ£âˆ¾"d"â‹ˆâŠ¢)
Text â‡ ("text"Attr"dy"â€¿"0.33em"âŠ¸âˆ¾)âŠ¸Enc
TSize â‡ "font-size"â‹ˆNumâˆ¾"px"Ë™

Background â‡ <"fill=white" Rect âŠ¢
Outline â‡ <"stroke=#111|fill=none" Rect âŠ¢

Legend â‡ {
  placeâ€¿spacingâ€¿padâ€¿widthâ€¿labelâ€¿isRHâ€¿Samples â† ğ•©
  y â† pad+spacingÃ—0.5+â†•nâ†â‰ label
  dim â† âŸ¨width,(2Ã—pad)+spacingÃ—nâŸ©
  rhs â† At"font-weight=bold|stroke-width=0.6|stroke=#211|fill=#24851d"
  ltr â† "transform=translate("âˆ¾")"âˆ¾Ëœâˆ¾âŸœ","âŠ¸âˆ¾Â´Num place
  legend â† (ltrâˆ¾"|text-anchor=start|font-size=13px") Ge âŸ¨
    "fill=white|stroke=#111" Rect 0â€¿0â‰dim
    Samples y
    (rhsâŠ¸âˆ¾Â¨âŒ¾(isRHâŠ¸/)36 Posâˆ˜â‹ˆÂ¨y) TextÂ¨ label
  âŸ©
}

Tick â‡ {
  offâ€¿dimâ€¿orientâ€¿tposâ€¿ttext â† ğ•©
  s â† 'h'=orient
  DT â† {
    h â† 'h'=ğ•¨
    P â† âŒ½âŒ¾(2âŠ¸â†‘)âŸh âˆ¾âŸœ((Â¬h)âŠâ‰offâ‰dim)
    ("path"Elt"d"â‹ˆÂ·âˆ¾("M "âˆ¾ğ•¨)âˆ¾Â¨Numâˆ˜P)Â¨ ğ•©
  }
  Filter â† âŠ¢ /Â¨Ëœ 1â‰¤(sâŠdim)(-âŒŠâŠ¢)-âŸœ(sâŠoff)
  TT â† {
    0ğ•Špâ€¿t: p ("text"AttrÂ·Posâ‹ˆâŸœ((1âŠ‘off+dim)+13))âŠ¸EncÂ¨ t ;
    1ğ•Špâ€¿t: "text-anchor=end" Ge p (Pos Â¯6âŠ¸â‹ˆ)âŠ¸TextÂ¨ t
  }
  âŸ¨
    "stroke-width=0.3|stroke=#555" Ge orient DTÂ¨ Filter tpos
    "font-size=11px" Ge s TTÂ¨ tpos â‹ˆÂ¨ ttext
  âŸ©
}
