#! /usr/bin/env bqn

Encâ€¿Attrâ€¿Atâ€¿Eltâ€¿Numâ€¿Posâ€¿SVGâ€¿Geâ€¿Rdimâ€¿Rectâ€¿Textâ€¿Path â† â€¢Import "util.bqn"

input â† â€¢wdpathâŠ¸â€¢file.AtÂ¨ â€¢args
n â† â‰ input

Read â† {
  ToNats â† ((>âŸœÂ«0âŠ¸â‰¤) / 0(0âŠ¸â‰¤Ã—Ã—âŸœ10âŠ¸+)`âŠ¢) Â· 10âŠ¸â‰¤âŠ¸(Â¬âŠ¸Ã—-âŠ£) -âŸœ'0'
  tab â† âˆ˜â€¿3 â¥Š ToNats '.'âŠ¸â‰ âŠ¸/ â€¢file.Chars ğ•©
  0â€¿2âŠ¸âŠË˜ Ã·âŸœ1e3âŒ¾(1â†“â‰) 4 â†“ tab
}

fname â† ((Â»âˆ¨`)âˆ˜=âŸœ'_'âŠ¸/ Â·âˆ§`âˆ˜â‰ âŸœ'.'âŠ¸/ â€¢file.Name)Â¨ â€¢args

dat â† â‰âˆ˜ReadÂ¨ input
! 1=+Â´âˆŠâŠÂ¨dat

namelist  â† "quad"â€¿"pdq" â€¿"flux"â€¿"wolf"â€¿"ska_"â€¿"rh"
colorlist â† "#6ad"â€¿"#c7d"â€¿"#b9e"â€¿"#cc6"â€¿"#da4"â€¿"#24851d"
rhf â† (1-Ëœâ‰ namelist) = ni â† namelist âŠfname
col â† "stroke"âŠ¸â‹ˆÂ¨ colors â† niâŠcolorlist
names â† rhf âŠ£â—¶âŸ¨âŠ¢âˆ¾"sort"Ë™,"Robin Hood"âŸ©Â¨ fname

width â† 512
off â† 50â€¿40 â‹„ end â† 20â€¿36
padi  â† 0â€¿20

gr â† "stroke-width=1.2|font-size=14px|text-anchor=middle"
TT â† < (Text("font-size"â‹ˆNumâˆ˜âŠ‘âˆ¾"px"Ë™)âˆ¾Â·Pos(widthÃ·2)â‹ˆ1âŠ‘âŠ¢)âŠ¸Enc

win â† -Ëœ`Â¨ bounds â† (âŒŠÂ´â‰âŒˆÂ´)Â¨ pts â† <âˆ˜âˆ¾Ë˜ xy â† â‰> <Ë˜Â¨ â‹†â¼dat
dim â† width (âŠ£â‹ˆÃ—) 0.55
out â† (-off)â‰dim+off+end
Scale â† padi+(dim-2Ã—padi)Ã— ({Â¬ğ•}âŒ¾(1âŠ¸âŠ‘) {ğ•©Ã·Ëœğ•¨-ËœâŠ¢}Â´Â¨ win) {ğ•ğ•©}Â¨ âŠ¢
line â† (/â‰ Â¨âŠxy) âŠ” Num â‰> Scale pts

ls â† 18
lh â† lsÃ—1+â†•n
lw â† 134
ld â† âŸ¨lw,lsÃ—1+nâŸ©
rhs â† (At"font-weight=bold|stroke-width=0.6|stroke=#211")âˆ¾"fill"â‹ˆÂ¯1âŠ‘colorlist
ltr â† "transform=translate("âˆ¾")"âˆ¾Ëœâˆ¾âŸœ","âŠ¸âˆ¾Â´Num dim-10+ld
legend â† (ltrâˆ¾"|text-anchor=start|font-size=13px") Ge âŸ¨
  "fill=white|stroke=#111" Rect 0â€¿0â‰ld
  "stroke-width=2.6" Ge col â‰âŠ¸PathâŸœ(âˆ¾"M h"âˆ¾Â¨Num)Â¨ (8âˆ¾âˆ¾âŸœ22)Â¨ lh
  (rhsâŠ¸âˆ¾Â¨âŒ¾(rhfâŠ¸/)36 Posâˆ˜â‹ˆÂ¨lh) ("text"Attr"dy"â€¿"0.33em"âŠ¸âˆ¾)âŠ¸EncÂ¨ names
âŸ©

tpos â† Scale â‹†â¼ ticks â† âŸ¨10â‹†2+â†•6, 5âˆ¾10Ã—1+â†•9âŸ©
DT â† {
  P â† ('h'=ğ•¨)â—¶âŸ¨âˆ¾âŸœ(0â€¿1Ã—dim),Â¯1âŒ½âˆ¾âŸœ(1â€¿0Ã—dim)âŸ©
  ("path"Elt"d"â‹ˆÂ·âˆ¾("M "âˆ¾ğ•¨)âˆ¾Â¨Numâˆ˜P)Â¨ ğ•©
}

â€¢OutÂ¨ (â¥Šout) SVG gr Ge âˆ¾â¥ŠÂ¨ âŸ¨
  <"fill=white" Rect out
  âŸ¨18,Â¯19âŸ© TT "Sorting random 4-byte integers"
  "text"âŠ¸AttrâŠ¸EncËœÂ´Â¨ âŸ¨
    âŸ¨"Size", "dy"â€¿"1em"âˆ¾Pos 0â€¿16+dimÃ—0.5â€¿1âŸ©
    âŸ¨"Time (ns / value)", "transform"â€¿"rotate(-90)"âˆ¾"dy"â€¿"-0.35em"âˆ¾Pos 0â€¿22-ËœâŒ½dimÃ—0â€¿Â¯0.5âŸ©
  âŸ©
  "stroke-width=0.3|stroke=#555" Ge "vh" DTÂ¨ (Â¯1â†“1â†“âŠ¢)âŒ¾âŠ‘ tpos
  "font-size=11px" Ge âŸ¨
    tpos ("text"AttrÂ·Posâ‹ˆâŸœ((1âŠ‘dim)+13))âŠ¸EncÂ¨âŸœ(1e3âŠ¸<â—¶Numâ€¿("1e"âˆ¾'0'+Â·âŒŠ0.5+10â‹†â¼âŠ¢)Â¨)â—‹âŠ‘ ticks
    "text-anchor=end" Ge tpos (TextÂ·Pos Â¯6âŠ¸â‹ˆ)âŠ¸EncÂ¨âŸœNumâ—‹(Â¯1â†“1âŠ¸âŠ‘) ticks
  âŸ©
  "stroke-width=2.6|fill=none" Ge col â‰âŠ¸PathâŸœ('M'âŒ¾âŠ‘âˆ˜âˆ¾Â·â¥Š "L "âˆ¾Â¨â‰1âŠ¢)Â¨ line
  <"stroke=#111|fill=none" Rect 0â€¿0â‰dim
  legend
âŸ©
