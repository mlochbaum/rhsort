#! /usr/bin/env bqn

util â† â€¢Import "util.bqn"
Encâ€¿Attrâ€¿Atâ€¿Eltâ€¿Numâ€¿Posâ€¿SVGâ€¿Ge â† util
Rectâ€¿Textâ€¿TSizeâ€¿Pathâ€¿Backgroundâ€¿Outlineâ€¿Legendâ€¿Tick â† util

input â† â€¢wdpathâŠ¸â€¢file.AtÂ¨ â€¢args
n â† â‰ input

Read â† {
  ToNats â† ((>âŸœÂ«0âŠ¸â‰¤) / 0(0âŠ¸â‰¤Ã—Ã—âŸœ10âŠ¸+)`âŠ¢) Â· 10âŠ¸â‰¤âŠ¸(Â¬âŠ¸Ã—-âŠ£) -âŸœ'0'
  tab â† âˆ˜â€¿3 â¥Š ToNats '.'âŠ¸â‰ âŠ¸/ â€¢file.Chars ğ•©
  0â€¿2âŠ¸âŠË˜ Ã·âŸœ1e3âŒ¾(1â†“â‰) 4 â†“ tab
}

fname â† ((Â»âˆ¨`)âˆ˜=âŸœ'_'âŠ¸/ Â·âˆ§`âˆ˜â‰ âŸœ'.'âŠ¸/ â€¢file.Name)Â¨ â€¢args

dat â† â‰âˆ˜ReadÂ¨ input
! 1=+Â´âˆŠâŠÂ¨dat

namelist  â† "quad"â€¿"pdq" â€¿"flux"â€¿"wolf"â€¿"ska_"â€¿"rh"
colorlist â† "#6ad"â€¿"#c7d"â€¿"#b9e"â€¿"#cc6"â€¿"#da4"â€¿"#24851d"
rhf â† (1-Ëœâ‰ namelist) = ni â† namelist âŠfname
col â† "stroke"âŠ¸â‹ˆÂ¨ colors â† niâŠcolorlistâˆ¾<"black"
names â† rhf âŠ£â—¶âŸ¨âŠ¢âˆ¾"sort"âˆ¾"_copy"/Ëœ"ska_"âŠ¸â‰¡,"Robin Hood"âŸ©Â¨ fname

width â† 512
off â† 50â€¿40 â‹„ end â† 20â€¿46
padi  â† 0â€¿20

gr â† "stroke-width=1.2|font-size=14px|text-anchor=middle"
TT â† < TSizeâŠ¸âˆ¾âŸœ(Pos(widthÃ·2)âŠ¸â‹ˆ)Â´âŠ¸Text

win â† -Ëœ`Â¨ bounds â† (âŒŠÂ´â‰âŒˆÂ´)Â¨ pts â† <âˆ˜âˆ¾Ë˜ xy â† â‰> <Ë˜Â¨ â‹†â¼dat
dim â† width (âŠ£â‹ˆÃ—) 0.55
out â† (-off)â‰dim+off+end
Scale â† padi+(dim-2Ã—padi)Ã— ({Â¬ğ•}âŒ¾(1âŠ¸âŠ‘) {ğ•©Ã·Ëœğ•¨-ËœâŠ¢}Â´Â¨ win) {ğ•ğ•©}Â¨ âŠ¢
line â† (/â‰ Â¨âŠxy) âŠ” Num â‰> Scale pts

â€¢OutÂ¨ (â¥Šout) SVG gr Ge âˆ¾â¥ŠÂ¨ âŸ¨
  Background out
  âŸ¨18,Â¯19âŸ© TT "Sorting random 4-byte integers"
  "text"âŠ¸AttrâŠ¸EncËœÂ´Â¨ âŸ¨
    âŸ¨"Size", "dy"â€¿"1em"âˆ¾Pos 0â€¿16+dimÃ—0.5â€¿1âŸ©
    âŸ¨"Time (ns / value)", "transform"â€¿"rotate(-90)"âˆ¾"dy"â€¿"-0.35em"âˆ¾Pos 0â€¿22-ËœâŒ½dimÃ—0â€¿Â¯0.5âŸ©
  âŸ©
  Tick {
    offâ‡0â€¿0 â‹„ dimâ‡dim
    orientâ‡"vh"
    tpos â‡ Scale â‹†â¼ ticks â† âŸ¨10â‹†2+â†•6, 5âˆ¾10Ã—1+â†•7âŸ©
    ttext â‡ âŸ¨1e3âŠ¸<â—¶Numâ€¿("1e"âˆ¾'0'+Â·âŒŠ0.5+10â‹†â¼âŠ¢)Â¨, NumâŸ© {ğ•ğ•©}Â¨ ticks
  }
  "stroke-width=2.6|fill=none" Ge col â‰âŠ¸PathâŸœ('M'âŒ¾âŠ‘âˆ˜âˆ¾Â·â¥Š "L "âˆ¾Â¨â‰1âŠ¢)Â¨ line
  Outline 0â€¿0â‰dim
  Legend {
    label â‡ names â‹„ isRH â‡ rhf
    place â‡ 10â€¿6
    width â‡ 134 â‹„ spacing â‡ 18 â‹„ pad â‡ 6
    Samples â‡ "stroke-width=2.6" Ge col â‰âŠ¸PathâŸœ(âˆ¾"M h"âˆ¾Â¨Num)Â¨ (8âˆ¾âˆ¾âŸœ22)Â¨
  }
âŸ©
